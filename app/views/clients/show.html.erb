<% content_for :title, "View Client #{@client.id}" %>

<div class="row text-center">
  <div class="small-12 columns">
    <h1><%= @client.last_name %></h1>
    <h4>Client ID: <%= @client.id %></h4>
    <hr />
  </div>
</div>

<div class="row text-center">
  <div class="small-12 columns">

    <div class="panel">

      <h3>Assigned Behaviors</h3>
      <table id="behaviors" class="responsive no-wrap">
        <thead>
          <tr>
            <th class="all">Behavior</th>
            <th class="min-tablet-p">Times Reported</th>
            <th class="all">Occurrences</th>
            <th class="min-tablet-l">Edit</th>
            <th class="min-tablet-l">Remove</th>
          </tr>
        </thead>
          <% @client.behaviors.active.each do | behavior | %>
            <tr>
              <td><%= behavior.description %></td>
              <td><%= behavior.report_count %></td>
              <td><%= behavior.occurrence_count %></td>
              <td>
                <%= link_to edit_behavior_path behavior do %>
                  <i class="fa fa-edit"></i>&emsp;Edit
                <% end %>
              </td>
              <td>
                <%= link_to '<i class="fa fa-times"></i>&emsp;Remove'.html_safe, {controller: "behaviors", action: "remove", id: behavior}, data: {confirm: "Are you sure you would like to remove this behavior?\nThis will also remove all reports related to this behavior."} %>
              </td>
            </tr>
          <% end %>
      </table>

      <ul class="button-group">
        <li>
          <a href="#" data-reveal-id="new-behavior" class="button">
            <i class="fa fa-plus"></i>&emsp;Add Behavior
          </a>
        </li>
        <li>
          <%= link_to client_path(format: "xlsx", export: "behaviors"), class: "button success" do %>
            <i class="fa fa-file-excel-o"></i>&emsp;Export
          <% end %>
        </li>
      </ul>

    </div>

  </div>
</div>

<div class="row text-center">
  <div class="small-12 columns">

    <div class="panel">

      <h3>Behavior Reports</h3>
      <table id="reports" class="responsive no-wrap">
        <thead>
          <tr>
            <th class="all">Behavior</th>
            <th class="all">Occurrences</th>
            <th class="all">Reported On</th>
            <th class="min-tablet-l">Edit</th>
            <th class="min-tablet-l">Remove</th>
          </tr>
        </thead>
          <% @client.behavior_reports.active.each do | report | %>
            <tr>
              <td><%= report.behavior.description %></td>
              <td><%= report.occurrences %></td>
              <td><%= report.timestamp %></td>
              <td>
                <%= link_to edit_behavior_report_path report do %>
                  <i class="fa fa-edit"></i>&emsp;Edit
                <% end %>
              </td>
              <td>
                <%= link_to '<i class="fa fa-times"></i>&emsp;Remove'.html_safe, {controller: "behavior_reports", action: "remove", id: report}, data: {confirm: 'Are you sure you would like to remove this report?'} %>
              </td>
            </tr>
          <% end %>
      </table>

      <%= link_to client_path(format: "xlsx", export: "reports"), class: "button success" do %>
        <i class="fa fa-file-excel-o"></i>&emsp;Export
      <% end %>

    </div>

  </div>
</div>

<div class="reveal-modal" id="new-behavior" data-reveal>
  <div class="row text-center">
    <div class="small-12 medium-8 medium-centered columns">
      <h1>Add a Behavior</h1>
      <%= form_for Behavior.new do | f | %>
        <%= f.text_field :description %>
        <%= f.hidden_field :client_id, :value => @client.id %>
        <%= f.submit class: "button expand" %>
      <% end %>
    </div>
  </div>
  <a class="close-reveal-modal">&#215;</a>
</div>
